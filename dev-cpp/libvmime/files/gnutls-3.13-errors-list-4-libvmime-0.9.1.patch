--- libvmime-0.9.1/src/net/tls/TLSSession.cpp.org	2010-08-19 11:44:52.000000000 +0400
+++ libvmime-0.9.1/src/net/tls/TLSSession.cpp	2012-11-07 07:07:41.000000000 +0400
@@ -22,7 +22,6 @@
 //
 
 #include <gnutls/gnutls.h>
-#include <gnutls/extra.h>
 
 #include "vmime/config.hpp"
 
@@ -247,103 +246,159 @@
 
 	switch (code)
 	{
-	ERROR(GNUTLS_E_SUCCESS)
-	ERROR(GNUTLS_E_UNKNOWN_COMPRESSION_ALGORITHM)
-	ERROR(GNUTLS_E_UNKNOWN_CIPHER_TYPE)
-	ERROR(GNUTLS_E_LARGE_PACKET)
-	ERROR(GNUTLS_E_UNSUPPORTED_VERSION_PACKET)
-	ERROR(GNUTLS_E_UNEXPECTED_PACKET_LENGTH)
-	ERROR(GNUTLS_E_INVALID_SESSION)
-	ERROR(GNUTLS_E_FATAL_ALERT_RECEIVED)
-	ERROR(GNUTLS_E_UNEXPECTED_PACKET)
-	ERROR(GNUTLS_E_WARNING_ALERT_RECEIVED)
-	ERROR(GNUTLS_E_ERROR_IN_FINISHED_PACKET)
-	ERROR(GNUTLS_E_UNEXPECTED_HANDSHAKE_PACKET)
-	ERROR(GNUTLS_E_UNKNOWN_CIPHER_SUITE)
-	ERROR(GNUTLS_E_UNWANTED_ALGORITHM)
-	ERROR(GNUTLS_E_MPI_SCAN_FAILED)
-	ERROR(GNUTLS_E_DECRYPTION_FAILED)
-	ERROR(GNUTLS_E_MEMORY_ERROR)
-	ERROR(GNUTLS_E_DECOMPRESSION_FAILED)
-	ERROR(GNUTLS_E_COMPRESSION_FAILED)
 	ERROR(GNUTLS_E_AGAIN)
-	ERROR(GNUTLS_E_EXPIRED)
+	ERROR(GNUTLS_E_APPLICATION_ERROR_MAX)
+	ERROR(GNUTLS_E_APPLICATION_ERROR_MIN)
+	ERROR(GNUTLS_E_ASN1_DER_ERROR)
+	ERROR(GNUTLS_E_ASN1_DER_OVERFLOW)
+	ERROR(GNUTLS_E_ASN1_ELEMENT_NOT_FOUND)
+	ERROR(GNUTLS_E_ASN1_GENERIC_ERROR)
+	ERROR(GNUTLS_E_ASN1_IDENTIFIER_NOT_FOUND)
+	ERROR(GNUTLS_E_ASN1_SYNTAX_ERROR)
+	ERROR(GNUTLS_E_ASN1_TAG_ERROR)
+	ERROR(GNUTLS_E_ASN1_TAG_IMPLICIT)
+	ERROR(GNUTLS_E_ASN1_TYPE_ANY_ERROR)
+	ERROR(GNUTLS_E_ASN1_VALUE_NOT_FOUND)
+	ERROR(GNUTLS_E_ASN1_VALUE_NOT_VALID)
+	ERROR(GNUTLS_E_BAD_COOKIE)
+	ERROR(GNUTLS_E_BASE64_DECODING_ERROR)
+	ERROR(GNUTLS_E_BASE64_ENCODING_ERROR)
+	ERROR(GNUTLS_E_BASE64_UNEXPECTED_HEADER_ERROR)
+	ERROR(GNUTLS_E_CERTIFICATE_ERROR)
+	//ERROR(GNUTLS_E_CERTIFICATE_ERROR)
+	ERROR(GNUTLS_E_CERTIFICATE_KEY_MISMATCH)
+	ERROR(GNUTLS_E_CERTIFICATE_LIST_UNSORTED)
+	ERROR(GNUTLS_E_CHANNEL_BINDING_NOT_AVAILABLE)
+	ERROR(GNUTLS_E_COMPRESSION_FAILED)
+	ERROR(GNUTLS_E_CONSTRAINT_ERROR)
+	ERROR(GNUTLS_E_CRYPTODEV_DEVICE_ERROR)
+	ERROR(GNUTLS_E_CRYPTODEV_IOCTL_ERROR)
+	ERROR(GNUTLS_E_CRYPTO_ALREADY_REGISTERED)
+	ERROR(GNUTLS_E_CRYPTO_INIT_FAILED)
 	ERROR(GNUTLS_E_DB_ERROR)
-	ERROR(GNUTLS_E_SRP_PWD_ERROR)
-	ERROR(GNUTLS_E_INSUFFICIENT_CREDENTIALS)
+	ERROR(GNUTLS_E_DECOMPRESSION_FAILED)
+	ERROR(GNUTLS_E_DECRYPTION_FAILED)
+	ERROR(GNUTLS_E_DH_PRIME_UNACCEPTABLE)
+	ERROR(GNUTLS_E_ECC_NO_SUPPORTED_CURVES)
+	ERROR(GNUTLS_E_ECC_UNSUPPORTED_CURVE)
+	ERROR(GNUTLS_E_ENCRYPTION_FAILED)
+	ERROR(GNUTLS_E_ERROR_IN_FINISHED_PACKET)
+	ERROR(GNUTLS_E_EXPIRED)
+	ERROR(GNUTLS_E_FATAL_ALERT_RECEIVED)
+	ERROR(GNUTLS_E_FILE_ERROR)
+	ERROR(GNUTLS_E_GOT_APPLICATION_DATA)
+	ERROR(GNUTLS_E_HANDSHAKE_TOO_LARGE)
 	ERROR(GNUTLS_E_HASH_FAILED)
-	ERROR(GNUTLS_E_BASE64_DECODING_ERROR)
+	ERROR(GNUTLS_E_HEARTBEAT_PING_RECEIVED)
+	ERROR(GNUTLS_E_HEARTBEAT_PONG_RECEIVED)
+	ERROR(GNUTLS_E_IA_VERIFY_FAILED)
+	ERROR(GNUTLS_E_ILLEGAL_PARAMETER)
+	ERROR(GNUTLS_E_ILLEGAL_SRP_USERNAME)
+	ERROR(GNUTLS_E_INCOMPATIBLE_CRYPTO_LIBRARY)
+	//ERROR(GNUTLS_E_INCOMPATIBLE_GCRYPT_LIBRARY)
+	ERROR(GNUTLS_E_INCOMPATIBLE_LIBTASN1_LIBRARY)
+	ERROR(GNUTLS_E_INCOMPAT_DSA_KEY_WITH_TLS_PROTOCOL)
+	ERROR(GNUTLS_E_INSUFFICIENT_CREDENTIALS)
+	//ERROR(GNUTLS_E_INSUFFICIENT_CREDENTIALS)
+	ERROR(GNUTLS_E_INTERNAL_ERROR)
+	ERROR(GNUTLS_E_INTERRUPTED)
+	ERROR(GNUTLS_E_INVALID_PASSWORD)
+	ERROR(GNUTLS_E_INVALID_REQUEST)
+	ERROR(GNUTLS_E_INVALID_SESSION)
+	ERROR(GNUTLS_E_KEY_USAGE_VIOLATION)
+	ERROR(GNUTLS_E_LARGE_PACKET)
+	ERROR(GNUTLS_E_LOCKING_ERROR)
+	ERROR(GNUTLS_E_MAC_VERIFY_FAILED)
+	ERROR(GNUTLS_E_MEMORY_ERROR)
 	ERROR(GNUTLS_E_MPI_PRINT_FAILED)
-	ERROR(GNUTLS_E_REHANDSHAKE)
-	ERROR(GNUTLS_E_GOT_APPLICATION_DATA)
-	ERROR(GNUTLS_E_RECORD_LIMIT_REACHED)
-	ERROR(GNUTLS_E_ENCRYPTION_FAILED)
-	ERROR(GNUTLS_E_PK_ENCRYPTION_FAILED)
+	ERROR(GNUTLS_E_MPI_SCAN_FAILED)
+	ERROR(GNUTLS_E_NO_CERTIFICATE_FOUND)
+	ERROR(GNUTLS_E_NO_CERTIFICATE_STATUS)
+	ERROR(GNUTLS_E_NO_CIPHER_SUITES)
+	ERROR(GNUTLS_E_NO_COMPRESSION_ALGORITHMS)
+	ERROR(GNUTLS_E_NO_PRIORITIES_WERE_SET)
+	ERROR(GNUTLS_E_NO_TEMPORARY_DH_PARAMS)
+	ERROR(GNUTLS_E_NO_TEMPORARY_RSA_PARAMS)
+	ERROR(GNUTLS_E_OCSP_RESPONSE_ERROR)
+	ERROR(GNUTLS_E_OPENPGP_FINGERPRINT_UNSUPPORTED)
+	ERROR(GNUTLS_E_OPENPGP_GETKEY_FAILED)
+	ERROR(GNUTLS_E_OPENPGP_KEYRING_ERROR)
+	ERROR(GNUTLS_E_OPENPGP_PREFERRED_KEY_ERROR)
+	ERROR(GNUTLS_E_OPENPGP_SUBKEY_ERROR)
+	ERROR(GNUTLS_E_OPENPGP_UID_REVOKED)
+	ERROR(GNUTLS_E_PARSING_ERROR)
+	ERROR(GNUTLS_E_PKCS11_ATTRIBUTE_ERROR)
+	ERROR(GNUTLS_E_PKCS11_DATA_ERROR)
+	ERROR(GNUTLS_E_PKCS11_DEVICE_ERROR)
+	ERROR(GNUTLS_E_PKCS11_ERROR)
+	ERROR(GNUTLS_E_PKCS11_KEY_ERROR)
+	ERROR(GNUTLS_E_PKCS11_LOAD_ERROR)
+	ERROR(GNUTLS_E_PKCS11_PIN_ERROR)
+	ERROR(GNUTLS_E_PKCS11_PIN_EXPIRED)
+	ERROR(GNUTLS_E_PKCS11_PIN_LOCKED)
+	ERROR(GNUTLS_E_PKCS11_REQUESTED_OBJECT_NOT_AVAILBLE)
+	ERROR(GNUTLS_E_PKCS11_SESSION_ERROR)
+	ERROR(GNUTLS_E_PKCS11_SIGNATURE_ERROR)
+	ERROR(GNUTLS_E_PKCS11_SLOT_ERROR)
+	ERROR(GNUTLS_E_PKCS11_TOKEN_ERROR)
+	ERROR(GNUTLS_E_PKCS11_UNSUPPORTED_FEATURE_ERROR)
+	ERROR(GNUTLS_E_PKCS11_USER_ERROR)
+	ERROR(GNUTLS_E_PKCS1_WRONG_PAD)
 	ERROR(GNUTLS_E_PK_DECRYPTION_FAILED)
+	ERROR(GNUTLS_E_PK_ENCRYPTION_FAILED)
 	ERROR(GNUTLS_E_PK_SIGN_FAILED)
-	ERROR(GNUTLS_E_X509_UNSUPPORTED_CRITICAL_EXTENSION)
-	ERROR(GNUTLS_E_KEY_USAGE_VIOLATION)
-	ERROR(GNUTLS_E_NO_CERTIFICATE_FOUND)
-	ERROR(GNUTLS_E_INVALID_REQUEST)
-	ERROR(GNUTLS_E_SHORT_MEMORY_BUFFER)
-	ERROR(GNUTLS_E_INTERRUPTED)
-	ERROR(GNUTLS_E_PUSH_ERROR)
+	ERROR(GNUTLS_E_PK_SIG_VERIFY_FAILED)
+	ERROR(GNUTLS_E_PREMATURE_TERMINATION)
 	ERROR(GNUTLS_E_PULL_ERROR)
+	ERROR(GNUTLS_E_PUSH_ERROR)
+	ERROR(GNUTLS_E_RANDOM_FAILED)
+	ERROR(GNUTLS_E_RECEIVED_ILLEGAL_EXTENSION)
 	ERROR(GNUTLS_E_RECEIVED_ILLEGAL_PARAMETER)
+	ERROR(GNUTLS_E_RECORD_LIMIT_REACHED)
+	ERROR(GNUTLS_E_REHANDSHAKE)
 	ERROR(GNUTLS_E_REQUESTED_DATA_NOT_AVAILABLE)
-	ERROR(GNUTLS_E_PKCS1_WRONG_PAD)
-	ERROR(GNUTLS_E_RECEIVED_ILLEGAL_EXTENSION)
-	ERROR(GNUTLS_E_INTERNAL_ERROR)
-	ERROR(GNUTLS_E_DH_PRIME_UNACCEPTABLE)
-	ERROR(GNUTLS_E_FILE_ERROR)
+	ERROR(GNUTLS_E_SAFE_RENEGOTIATION_FAILED)
+	ERROR(GNUTLS_E_SESSION_EOF)
+	ERROR(GNUTLS_E_SHORT_MEMORY_BUFFER)
+	ERROR(GNUTLS_E_SRP_PWD_ERROR)
+	ERROR(GNUTLS_E_SRP_PWD_PARSING_ERROR)
+	ERROR(GNUTLS_E_SUCCESS)
+	ERROR(GNUTLS_E_TIMEDOUT)
 	ERROR(GNUTLS_E_TOO_MANY_EMPTY_PACKETS)
+	ERROR(GNUTLS_E_TOO_MANY_HANDSHAKE_PACKETS)
+	ERROR(GNUTLS_E_TPM_ERROR)
+	ERROR(GNUTLS_E_TPM_KEY_NOT_FOUND)
+	ERROR(GNUTLS_E_TPM_KEY_PASSWORD_ERROR)
+	ERROR(GNUTLS_E_TPM_SESSION_ERROR)
+	ERROR(GNUTLS_E_TPM_SRK_PASSWORD_ERROR)
+	ERROR(GNUTLS_E_TPM_UNINITIALIZED)
+	ERROR(GNUTLS_E_UNEXPECTED_HANDSHAKE_PACKET)
+	ERROR(GNUTLS_E_UNEXPECTED_PACKET)
+	ERROR(GNUTLS_E_UNEXPECTED_PACKET_LENGTH)
+	ERROR(GNUTLS_E_UNIMPLEMENTED_FEATURE)
+	ERROR(GNUTLS_E_UNKNOWN_ALGORITHM)
+	ERROR(GNUTLS_E_UNKNOWN_CIPHER_SUITE)
+	ERROR(GNUTLS_E_UNKNOWN_CIPHER_TYPE)
+	ERROR(GNUTLS_E_UNKNOWN_COMPRESSION_ALGORITHM)
+	ERROR(GNUTLS_E_UNKNOWN_HASH_ALGORITHM)
+	ERROR(GNUTLS_E_UNKNOWN_PKCS_BAG_TYPE)
+	ERROR(GNUTLS_E_UNKNOWN_PKCS_CONTENT_TYPE)
 	ERROR(GNUTLS_E_UNKNOWN_PK_ALGORITHM)
-	ERROR(GNUTLS_E_INIT_LIBEXTRA)
-	ERROR(GNUTLS_E_LIBRARY_VERSION_MISMATCH)
-	ERROR(GNUTLS_E_NO_TEMPORARY_RSA_PARAMS)
-	ERROR(GNUTLS_E_LZO_INIT_FAILED)
-	ERROR(GNUTLS_E_NO_COMPRESSION_ALGORITHMS)
-	ERROR(GNUTLS_E_NO_CIPHER_SUITES)
-	ERROR(GNUTLS_E_OPENPGP_GETKEY_FAILED)
-	ERROR(GNUTLS_E_PK_SIG_VERIFY_FAILED)
-	ERROR(GNUTLS_E_ILLEGAL_SRP_USERNAME)
-	ERROR(GNUTLS_E_SRP_PWD_PARSING_ERROR)
-	ERROR(GNUTLS_E_NO_TEMPORARY_DH_PARAMS)
-	ERROR(GNUTLS_E_ASN1_ELEMENT_NOT_FOUND)
-	ERROR(GNUTLS_E_ASN1_IDENTIFIER_NOT_FOUND)
-	ERROR(GNUTLS_E_ASN1_DER_ERROR)
-	ERROR(GNUTLS_E_ASN1_VALUE_NOT_FOUND)
-	ERROR(GNUTLS_E_ASN1_GENERIC_ERROR)
-	ERROR(GNUTLS_E_ASN1_VALUE_NOT_VALID)
-	ERROR(GNUTLS_E_ASN1_TAG_ERROR)
-	ERROR(GNUTLS_E_ASN1_TAG_IMPLICIT)
-	ERROR(GNUTLS_E_ASN1_TYPE_ANY_ERROR)
-	ERROR(GNUTLS_E_ASN1_SYNTAX_ERROR)
-	ERROR(GNUTLS_E_ASN1_DER_OVERFLOW)
-	//ERROR(GNUTLS_E_OPENPGP_TRUSTDB_VERSION_UNSUPPORTED)
-	ERROR(GNUTLS_E_OPENPGP_UID_REVOKED)
-	ERROR(GNUTLS_E_CERTIFICATE_ERROR)
-	//ERROR(GNUTLS_E_X509_CERTIFICATE_ERROR)
-	ERROR(GNUTLS_E_CERTIFICATE_KEY_MISMATCH)
+	ERROR(GNUTLS_E_UNKNOWN_SRP_USERNAME)
+	ERROR(GNUTLS_E_UNSAFE_RENEGOTIATION_DENIED)
 	ERROR(GNUTLS_E_UNSUPPORTED_CERTIFICATE_TYPE)
+	ERROR(GNUTLS_E_UNSUPPORTED_SIGNATURE_ALGORITHM)
+	ERROR(GNUTLS_E_UNSUPPORTED_VERSION_PACKET)
+	ERROR(GNUTLS_E_UNWANTED_ALGORITHM)
+	ERROR(GNUTLS_E_USER_ERROR)
+	ERROR(GNUTLS_E_WARNING_ALERT_RECEIVED)
+	ERROR(GNUTLS_E_WARNING_IA_FPHF_RECEIVED)
+	ERROR(GNUTLS_E_WARNING_IA_IPHF_RECEIVED)
 	ERROR(GNUTLS_E_X509_UNKNOWN_SAN)
-	ERROR(GNUTLS_E_OPENPGP_FINGERPRINT_UNSUPPORTED)
 	ERROR(GNUTLS_E_X509_UNSUPPORTED_ATTRIBUTE)
-	ERROR(GNUTLS_E_UNKNOWN_HASH_ALGORITHM)
-	ERROR(GNUTLS_E_UNKNOWN_PKCS_CONTENT_TYPE)
-	ERROR(GNUTLS_E_UNKNOWN_PKCS_BAG_TYPE)
-	ERROR(GNUTLS_E_INVALID_PASSWORD)
-	ERROR(GNUTLS_E_MAC_VERIFY_FAILED)
-	ERROR(GNUTLS_E_CONSTRAINT_ERROR)
-	ERROR(GNUTLS_E_BASE64_ENCODING_ERROR)
-	ERROR(GNUTLS_E_INCOMPATIBLE_GCRYPT_LIBRARY)
-	//ERROR(GNUTLS_E_INCOMPATIBLE_CRYPTO_LIBRARY)
-	ERROR(GNUTLS_E_INCOMPATIBLE_LIBTASN1_LIBRARY)
-	ERROR(GNUTLS_E_OPENPGP_KEYRING_ERROR)
+	ERROR(GNUTLS_E_X509_UNSUPPORTED_CRITICAL_EXTENSION)
+	ERROR(GNUTLS_E_X509_UNSUPPORTED_EXTENSION)
 	ERROR(GNUTLS_E_X509_UNSUPPORTED_OID)
-	//ERROR(GNUTLS_E_RANDOM_FAILED)
-	ERROR(GNUTLS_E_UNIMPLEMENTED_FEATURE)
-
 	default:
 
 		msg += "unknown error";
@@ -359,4 +414,3 @@
 } // tls
 } // net
 } // vmime
-
